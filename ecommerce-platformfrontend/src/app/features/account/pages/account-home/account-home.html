<div class="account-container">
  <h1>Mon Compte</h1>
  
  <!-- Informations utilisateur -->
  <div class="user-info">
    <h3>Informations personnelles</h3>
    <div class="info-row">
      <label>Nom:</label>
      <span *ngIf="!editMode">{{ user?.name || 'Non dÃ©fini' }}</span>
      <input *ngIf="editMode" [(ngModel)]="name" type="text" placeholder="Votre nom">
    </div>
    <div class="info-row">
      <label>Email:</label>
      <span *ngIf="!editMode">{{ user?.email || 'Non dÃ©fini' }}</span>
      <input *ngIf="editMode" [(ngModel)]="email" type="email" placeholder="Votre email">
    </div>
    <div class="info-row">
      <label>RÃ´le:</label>
      <span>{{ isAdmin ? 'Administrateur' : 'Client' }}</span>
    </div>
    
    <div class="edit-actions" *ngIf="!editMode">
      <button mat-raised-button color="primary" (click)="enableEdit()">
        <mat-icon>edit</mat-icon>
        Modifier le profil
      </button>
    </div>
    
    <div class="edit-actions" *ngIf="editMode">
      <button mat-raised-button color="primary" (click)="saveProfile()">
        <mat-icon>save</mat-icon>
        Sauvegarder
      </button>
      <button mat-stroked-button (click)="editMode = false">
        <mat-icon>cancel</mat-icon>
        Annuler
      </button>
    </div>
  </div>

  <!-- Section FonctionnalitÃ©s AfriMarket -->
  <div class="features-section">
    <h3>ðŸš€ FonctionnalitÃ©s AfriMarket</h3>
    
    <div class="feature-category">
      <h4>ðŸ›’ Gestion du panier</h4>
      <ul>
        <li>âœ… Ajout, suppression et modification des quantitÃ©s</li>
        <li>âœ… Calcul automatique du total</li>
      </ul>
    </div>

    <div class="feature-category">
      <h4>ðŸ“¦ Passage de commande</h4>
      <ul>
        <li>âœ… Formulaire de commande avec adresse de livraison et coordonnÃ©es</li>
        <li>âœ… Choix du mode de paiement :</li>
        <ul>
          <li>ðŸ’³ Paiement avant livraison (paiement en ligne simulÃ© ou rÃ©el)</li>
          <li>ðŸ’° Paiement aprÃ¨s livraison (paiement en espÃ¨ces Ã  la rÃ©ception)</li>
        </ul>
        <li>âœ… Validation finale de la commande</li>
      </ul>
    </div>

    <div class="feature-category">
      <h4>ðŸ‘¤ Compte client</h4>
      <ul>
        <li>âœ… Inscription, connexion, gestion du profil</li>
        <li>âœ… Historique des commandes avec dÃ©tails et statut (en attente, expÃ©diÃ©e, livrÃ©e, annulÃ©e)</li>
        <li>âœ… TÃ©lÃ©chargement des factures PDF</li>
      </ul>
    </div>

    <div class="feature-category">
      <h4>ðŸ“§ Notifications par email</h4>
      <ul>
        <li>âœ… Confirmation de commande</li>
        <li>âœ… Mise Ã  jour du statut de la commande (expÃ©diÃ©e, livrÃ©e)</li>
        <li>âœ… Confirmation de paiement</li>
      </ul>
    </div>
  </div>

  <!-- Section de nettoyage nuclÃ©aire (temporaire) -->
  <div style="background: linear-gradient(45deg, #ff1744, #d50000); color: white; padding: 20px; margin: 20px 0; border-radius: 10px; text-align: center; box-shadow: 0 4px 8px rgba(0,0,0,0.3);">
    <h2 style="margin: 0 0 15px 0; font-size: 24px;">ðŸ’¥ NETTOYAGE NUCLÃ‰AIRE ðŸ’¥</h2>
    <p style="margin: 0 0 20px 0; font-size: 16px;">Si vous voyez des commandes qui ne sont pas les vÃ´tres, cliquez ici pour tout nettoyer :</p>
    <button mat-raised-button 
            style="background: white; color: #d50000; font-size: 18px; padding: 15px 30px; font-weight: bold; border: 3px solid white;"
            (click)="nuclearCleanup()">
      <mat-icon style="font-size: 24px; margin-right: 10px;">delete_forever</mat-icon>
      NETTOYAGE NUCLÃ‰AIRE - SUPPRIMER TOUT MAINTENANT
    </button>
    
    <!-- Script de nettoyage manuel -->
    <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 8px;">
      <h4 style="margin: 0 0 10px 0;">ðŸ”§ Si le bouton ne fonctionne pas, copiez ce code dans la console (F12) :</h4>
      <textarea readonly style="width: 100%; height: 80px; background: #333; color: #00ff00; border: none; padding: 10px; font-family: monospace; font-size: 12px; border-radius: 4px;">Object.keys(localStorage).filter(key => key.toLowerCase().includes('order') || key.toLowerCase().includes('commande') || key.toLowerCase().includes('afrimarket')).forEach(key => localStorage.removeItem(key)); console.log('ðŸ’¥ NETTOYAGE NUCLÃ‰AIRE MANUEL EFFECTUÃ‰'); window.location.reload();</textarea>
      <p style="margin: 10px 0 0 0; font-size: 14px;">
        <strong>Instructions :</strong> Appuyez sur F12 â†’ Console â†’ Collez le code â†’ EntrÃ©e â†’ La page se recharge automatiquement
      </p>
    </div>
  </div>

  <!-- Espace Client -->
  <div class="client-space" *ngIf="!isAdmin">
    <h3>Espace Client</h3>
    
    <!-- Information -->
    <div class="info-box">
      <mat-icon>info</mat-icon>
      <div>
        <strong>Information FranÃ§ais:</strong> "Chaque client a son propre historique. Aucune commande d'autres clients n'est visible."<br>
      </div>
    </div>

    <h4>Mes commandes</h4>
    <div *ngIf="orders.length === 0" class="no-orders">
      <mat-icon>inventory_2</mat-icon>
      <p>Aucune commande pour le moment</p>
      <button mat-raised-button color="primary" routerLink="/catalog">
        <mat-icon>shopping_cart</mat-icon>
        Aller au catalogue
      </button>
    </div>
    
    <div *ngIf="orders.length > 0" class="orders-list">
      <div *ngFor="let order of orders" class="order-card">
        <div class="order-header">
          <h5>Commande #{{ order.id }}</h5>
          <span class="order-date">{{ order.date | date:'dd/MM/yyyy' }}</span>
          <span class="order-status" [class]="'status-' + order.status.toLowerCase().replace(' ', '-')">
            {{ order.status }}
          </span>
        </div>
        
        <div class="order-items">
          <div *ngFor="let item of order.items" class="order-item">
            <span class="item-name">{{ item.name }}</span>
            <span class="item-quantity">QtÃ©: {{ item.quantity }}</span>
            <span class="item-price">{{ item.price | currency:'FCFA':'symbol':'1.0-0':'fr' }}</span>
          </div>
        </div>
        
        <div class="order-footer">
          <span class="order-total">Total: {{ order.total | currency:'FCFA':'symbol':'1.0-0':'fr' }}</span>
          <div class="order-actions">
            <button mat-stroked-button (click)="openOrderDetail(order)">
              <mat-icon>visibility</mat-icon>
              DÃ©tails
            </button>
            <button mat-stroked-button (click)="downloadInvoice(order)">
              <mat-icon>download</mat-icon>
              TÃ©lÃ©charger la facture
            </button>
            <button mat-stroked-button (click)="testInvoiceGeneration()">
              <mat-icon>receipt</mat-icon>
              Test facture
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Espace Admin -->
  <div class="admin-space" *ngIf="isAdmin">
    <h3>Espace Administrateur</h3>
    
    <div class="admin-actions">
      <button mat-raised-button color="primary" (click)="navigateToProducts()">
        <mat-icon>inventory</mat-icon>
        GÃ©rer les produits
      </button>
      <button mat-raised-button color="primary" (click)="navigateToCategories()">
        <mat-icon>category</mat-icon>
        GÃ©rer les catÃ©gories
      </button>
      <button mat-raised-button color="primary" (click)="navigateToUsers()">
        <mat-icon>people</mat-icon>
        GÃ©rer les utilisateurs
      </button>
      <button mat-raised-button color="primary" (click)="navigateToStats()">
        <mat-icon>analytics</mat-icon>
        Statistiques
      </button>
    </div>

    <h4>Toutes les commandes</h4>
    <div *ngIf="orders.length === 0" class="no-orders">
      <mat-icon>inventory_2</mat-icon>
      <p>Aucune commande dans le systÃ¨me</p>
    </div>
    
    <div *ngIf="orders.length > 0" class="orders-list">
      <div *ngFor="let order of orders" class="order-card admin-order">
        <div class="order-header">
          <h5>Commande #{{ order.id}} - Client: {{ order.clientEmail }}</h5>
          <span class="order-date">{{ order.date | date:'dd/MM/yyyy' }}</span>
          <span class="order-status" [class]="'status-' + order.status.toLowerCase().replace(' ', '-')">
            {{ order.status }}
          </span>
        </div>
        
        <div class="order-items">
          <div *ngFor="let item of order.items" class="order-item">
            <span class="item-name">{{ item.name }}</span>
            <span>QtÃ©: {{ item.quantity }}</span>
            <span>{{ item.price | currency:'FCFA':'symbol':'1.0-0':'fr' }}</span>
          </div>
        </div>
        
        <div class="order-footer">
          <span class="order-total">Total: {{ order.total | currency:'FCFA':'symbol':'1.0-0':'fr' }}</span>
          <div class="order-actions">
            <button mat-stroked-button (click)="openOrderDetail(order)">
              <mat-icon>visibility</mat-icon>
              DÃ©tails
            </button>
            <button mat-stroked-button (click)="updateOrderStatus(order.id, 'ConfirmÃ©e')">
              <mat-icon>check_circle</mat-icon>
              Confirmer
            </button>
            <button mat-stroked-button (click)="updateOrderStatus(order.id, 'En cours de livraison')">
              <mat-icon>local_shipping</mat-icon>
              ExpÃ©dier
            </button>
            <button mat-stroked-button (click)="updateOrderStatus(order.id, 'LivrÃ©e')">
              <mat-icon>done_all</mat-icon>
              LivrÃ©e
            </button>
            <button mat-stroked-button color="warn" (click)="cancelOrder(order.id)">
              <mat-icon>cancel</mat-icon>
              Annuler
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Gestion des adresses -->
  <div class="addresses-section">
    <h3>Mes adresses de livraison</h3>
    
    <button mat-raised-button color="primary" (click)="startAddAddress()" *ngIf="!showAddressForm">
      <mat-icon>add_location</mat-icon>
      Ajouter une adresse
    </button>
    
    <form *ngIf="showAddressForm" (ngSubmit)="saveAddress()" class="address-form">
      <mat-form-field appearance="outline">
        <mat-label>Nom de l'adresse</mat-label>
        <input matInput [(ngModel)]="addressForm.name" name="name" required>
      </mat-form-field>
      
      <mat-form-field appearance="outline">
        <mat-label>Rue</mat-label>
        <input matInput [(ngModel)]="addressForm.street" name="street" required>
      </mat-form-field>
      
      <mat-form-field appearance="outline">
        <mat-label>Ville</mat-label>
        <input matInput [(ngModel)]="addressForm.city" name="city" required>
      </mat-form-field>
      
      <mat-form-field appearance="outline">
        <mat-label>Code postal</mat-label>
        <input matInput [(ngModel)]="addressForm.postalCode" name="postalCode" required>
      </mat-form-field>
      
      <mat-form-field appearance="outline">
        <mat-label>Pays</mat-label>
        <input matInput [(ngModel)]="addressForm.country" name="country" required>
      </mat-form-field>
      
      <mat-form-field appearance="outline">
        <mat-label>TÃ©lÃ©phone</mat-label>
        <input matInput [(ngModel)]="addressForm.phone" name="phone" required>
      </mat-form-field>
      
      <div class="form-actions">
        <button mat-raised-button color="primary" type="submit">
          <mat-icon>save</mat-icon>
          {{ editingAddressId ? 'Modifier' : 'Ajouter' }}
        </button>
        <button mat-stroked-button type="button" (click)="cancelAddressForm()">
          <mat-icon>cancel</mat-icon>
          Annuler
        </button>
      </div>
    </form>
    
    <div class="addresses-list">
      <div *ngFor="let addr of addresses" class="address-card">
        <div class="address-info">
          <h4>{{ addr.name }}</h4>
          <p>{{ addr.street }}</p>
          <p>{{ addr.city }}, {{ addr.postalCode }}</p>
          <p>{{ addr.country }}</p>
          <p>TÃ©l: {{ addr.phone }}</p>
        </div>
        <div class="address-actions">
          <button mat-icon-button (click)="startEditAddress(addr)">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button color="warn" (click)="deleteAddress(addr.id)">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Favoris -->
  <div class="favorites-section">
    <h3>Mes favoris</h3>
    <div *ngIf="favorites.length === 0" class="no-favorites">
      <mat-icon>favorite_border</mat-icon>
      <p>Aucun produit favori</p>
      <button mat-raised-button color="primary" routerLink="/catalog">
        <mat-icon>shopping_cart</mat-icon>
        DÃ©couvrir des produits
      </button>
    </div>
    
    <div *ngIf="favorites.length > 0" class="favorites-grid">
      <div *ngFor="let product of favorites" class="favorite-item">
        <img [src]="product.image" [alt]="product.name">
        <h4>{{ product.name }}</h4>
        <p>{{ product.price | currency:'FCFA':'symbol':'1.0-0':'fr' }}</p>
        <button mat-raised-button color="primary" (click)="addToCart(product)">
          <mat-icon>add_shopping_cart</mat-icon>
          Ajouter au panier
        </button>
      </div>
    </div>
  </div>

  <!-- Bouton de dÃ©connexion -->
  <div style="text-align: center; margin-top: 20px;">
    <button mat-raised-button 
            color="warn" 
            (click)="logout()"
            style="background: #f44336; color: white; padding: 12px 24px; font-size: 16px; font-weight: bold;">
      <mat-icon style="margin-right: 8px;">logout</mat-icon>
      Se dÃ©connecter
    </button>
  </div>
</div>
